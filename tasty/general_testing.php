select cb.bookmark_id, cb.title, cb.notes, unix_timestamp(cb.date_posted) as date_posted, cl.login, bu.url, count(bu.url) as popularity, count(fb.bookmark_id) as flag_count, count(blocked_customer_id) as block_count from customer_bookmarks cb inner join customer_logins cl on cb.customer_id = cl.customer_id inner join bookmark_urls bu on cb.bookmark_id = bu.bookmark_id left outer join flagged_bookmarks fb on bu.bookmark_id = fb.bookmark_id left outer join block_member bm on cb.customer_id = bm.blocked_customer_id where (fb.bookmark_id is null or !(fb.customer_id = '11' or fb.ip_address = '')) and (bm.blocked_customer_id is null or !(bm.blocking_customer_id = '11' or bm.ip_address = '')) and cb.date_deleted <= 0 group by cb.bookmark_id;